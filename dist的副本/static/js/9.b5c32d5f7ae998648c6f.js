webpackJsonp([9],{"1QFH":function(t,e,a){(t.exports=a("FZ+f")(!1)).push([t.i,"",""])},fTHp:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a("qsHl"),s={name:"goodsCategory",data:function(){return{typeList:[],query:{curPage:1,pageSize:10},totelCount:1,listLoading:!0,loading:!1,isShowDialog:!1,dialogStatus:"",textMap:{update:"修改商品分类",create:"新增分类"},categoryForm:{pcat:"",catName:"",shops:[]},categoryList:[],queryShops:{pcat:"",cat:"",shopId:"",shopName:""},shopData:[],openShopData:!1,multipleSelection:[],categoryRules:{pcat:[{required:!0,message:"请选择一级分类",trigger:"change"}],catName:[{required:!0,message:"请填写二级分类",trigger:"blur"}]},checkRate:{rate:[{required:!0,message:"佣金不能为空",trigger:"blur"},{type:"number",min:0,max:100,message:"佣金必须为0-100之间的数字",trigger:"blur"}]},updateDate:{},cancelStatus:!1,updateForm:{pcat:"",cat:"",catName:"",shopIds:[]}}},created:function(){this.getTypeList()},methods:{deleteType:function(t){var e=this;0===t.shopNum?this.$confirm("是否确定删除类目:"+t.catName,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(o.d)(t.pcat,t.cat).then(function(t){e.getTypeList(),e.$message({type:"success",message:"删除成功!"})})}).catch(function(){}):this.$message({message:"存在可用门店，不能删除该类目",type:"error"})},addFirstType:function(){var t=this;this.$prompt("类目名称","增加一级类目",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"text",inputPattern:/\S/,inputErrorMessage:"内容不能为空"}).then(function(e){var a=e.value;a&&Object(o.b)(a).then(function(e){t.getGoodsCategory(),t.$message({type:"success",message:a+"已添加"})})}).catch(function(){})},onUpdate:function(){var t=this;this.$refs.updateForm.validate(function(e){e&&(t.loading=!0,Object(o.a)(t.updateForm).then(function(e){t.getTypeList(),t.$message({type:"success",message:"修改成功!"}),t.loading=!1,t.isShowDialog=!1}).catch(function(){t.loading=!1}))})},returnShop:function(t){t.isSelect=!1,this.updateForm.shopIds.indexOf(t.id)>=0&&this.updateForm.shopIds.splice(this.updateForm.shopIds.indexOf(t.id),1)},deleteShop:function(t){t.isSelect=!0,this.updateForm.shopIds.push(t.id)},updateType:function(t){this.updateForm.cat=t.cat,this.updateForm.pcat=t.pcat,this.updateForm.catName=t.catName,this.queryShops.pcat=t.pcat,this.queryShops.cat=t.cat,this.updateDate=t,this.dialogStatus="update",this.isShowDialog=!0},onSave:function(){var t=this;this.$refs.categoryForm.validate(function(e){e&&(t.multipleSelection.forEach(function(e){t.categoryForm.shops.push({shopId:e.id,rate:e.rate})}),t.loading=!0,Object(o.c)(t.categoryForm).then(function(e){t.getTypeList(),t.$message({type:"success",message:"保存成功!"}),t.loading=!1,t.isShowDialog=!1}).catch(function(){t.loading=!1}))})},addType:function(){this.dialogStatus="create",this.getGoodsCategory(),this.isShowDialog=!0},handleSelection:function(t,e){t.indexOf(e)<0?e.isSelect=!1:e.isSelect=!0},handleSelectionChange:function(t){this.multipleSelection=t},getQueryShops:function(){var t=this;this.queryShops.shopId||this.queryShops.shopName?Object(o.g)(this.queryShops).then(function(e){if(e.data){var a=e.data;t.shopData=a.map(function(e){return t.$set(e,"rate",""),t.$set(e,"isSelect",!1),e})}else t.shopData=[];t.openShopData=!0}):this.$message({message:"门店编号、门店名称至少写一个",type:"error"})},getGoodsCategory:function(){var t=this;Object(o.e)().then(function(e){e.data?t.categoryList=e.data:t.categoryList=[]})},handleCurrentChange:function(t){this.query.curPage=t,this.getTypeList()},getTypeList:function(){var t=this;this.listLoading=!0,Object(o.f)(this.query).then(function(e){e.data?(t.typeList=e.data.shopCatGroups,t.totelCount=e.data.tolCount,t.query.pageSize=e.data.pageSize,t.query.curPage=e.data.curPage):t.typeList=[],t.listLoading=!1}).catch(function(){t.listLoading=!1})},isClose:function(){"create"===this.dialogStatus?(void 0!==this.$refs.categoryForm&&this.$refs.categoryForm.resetFields(),this.categoryForm={pcat:"",catName:"",shops:[]}):(void 0!==this.$refs.updateForm&&this.$refs.updateForm.resetFields(),this.updateForm={pcat:"",cat:"",catName:"",shopIds:[]}),this.queryShops={pcat:"",cat:"",shopId:"",shopName:""},this.openShopData=!1,this.dialogStatus=""}}},i={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("div",{staticClass:"filter-container"},[a("el-row",{attrs:{type:"flex",justify:"space-between"}},[a("el-col",{attrs:{span:12}},[a("div",{staticStyle:{"line-height":"32px"}},[t._v("商品分类管理")])]),t._v(" "),a("el-col",{attrs:{span:12}},[a("div",{staticStyle:{"text-align":"right"}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-edit"},on:{click:t.addType}},[t._v("添加商品分类")])],1)])],1)],1),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading.body",value:t.listLoading,expression:"listLoading",modifiers:{body:!0}}],attrs:{data:t.typeList,"element-loading-text":"Loading",border:"",fit:"","highlight-current-row":""}},[a("el-table-column",{attrs:{align:"center",label:"序号"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(e.$index+1)+"\n      ")]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"pcatName",label:"一级类目",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"catName",label:"二级类目",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"shopNum",label:"可用门店",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticStyle:{"text-align":"left"}},[a("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:function(a){t.updateType(e.row)}}},[t._v("修改")]),t._v(" "),a("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(a){t.deleteType(e.row)}}},[t._v("删除")])],1)]}}])})],1),t._v(" "),a("div",{staticClass:"pagination-container"},[a("el-pagination",{attrs:{"current-page":t.query.curPage,"page-size":t.query.pageSize,layout:"total,prev, pager, next, jumper",total:t.totelCount},on:{"current-change":t.handleCurrentChange}})],1),t._v(" "),a("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.isShowDialog,"show-close":!1},on:{close:t.isClose,"update:visible":function(e){t.isShowDialog=e}}},["create"==t.dialogStatus?a("el-form",{ref:"categoryForm",attrs:{model:t.categoryForm,rules:t.categoryRules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"一级类目",prop:"pcat"}},[a("el-select",{attrs:{placeholder:"一级类目"},model:{value:t.categoryForm.pcat,callback:function(e){t.$set(t.categoryForm,"pcat",e)},expression:"categoryForm.pcat"}},t._l(t.categoryList,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),t._v(" "),a("el-button",{attrs:{type:"primary",size:"medium"},on:{click:t.addFirstType}},[t._v("增加一级分类")])],1),t._v(" "),a("el-form-item",{attrs:{label:"二级类目",prop:"catName"}},[a("el-input",{staticStyle:{width:"70%"},attrs:{"auto-complete":"off",placeholder:"请输入二级类目"},model:{value:t.categoryForm.catName,callback:function(e){t.$set(t.categoryForm,"catName","string"==typeof e?e.trim():e)},expression:"categoryForm.catName"}})],1),t._v(" "),a("div",{staticClass:"filterShop"},[a("div",[a("span",[a("strong",[t._v("可用门店:")])]),t._v(" "),a("span",[t._v("门店编码")]),t._v(" "),a("el-input",{staticStyle:{width:"20%"},attrs:{"auto-complete":"off"},model:{value:t.queryShops.shopId,callback:function(e){t.$set(t.queryShops,"shopId","string"==typeof e?e.trim():e)},expression:"queryShops.shopId"}}),t._v(" "),a("span",[t._v("门店名称")]),t._v(" "),a("el-input",{staticStyle:{width:"20%"},attrs:{"auto-complete":"off"},model:{value:t.queryShops.shopName,callback:function(e){t.$set(t.queryShops,"shopName","string"==typeof e?e.trim():e)},expression:"queryShops.shopName"}}),t._v(" "),a("el-button",{attrs:{type:"primary",size:"medium"},on:{click:t.getQueryShops}},[t._v("筛选")])],1),t._v(" "),t.openShopData?a("div",[a("el-table",{ref:"multipleTable",staticStyle:{width:"100%","margin-top":"10px"},attrs:{data:t.shopData,"max-height":"180",border:""},on:{select:t.handleSelection,"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),t._v(" "),a("el-table-column",{attrs:{prop:"id",label:"门店名称"}}),t._v(" "),a("el-table-column",{attrs:{prop:"name",label:"门店名称"}}),t._v(" "),a("el-table-column",{attrs:{prop:"type",label:"门店类别"}}),t._v(" "),a("el-table-column",{attrs:{label:"佣金"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.isSelect?a("el-form",{ref:"scope.row",staticClass:"checkRate",attrs:{model:e.row,rules:t.checkRate}},[a("el-form-item",{attrs:{prop:"rate"}},[a("el-input",{staticStyle:{width:"80px"},model:{value:e.row.rate,callback:function(a){t.$set(e.row,"rate",t._n(a))},expression:"scope.row.rate"}}),t._v(" "),a("span",[t._v("%")])],1)],1):t._e()]}}])})],1)],1):t._e()])],1):t._e(),t._v(" "),"update"==t.dialogStatus?a("el-form",{ref:"updateForm",attrs:{model:t.updateForm,rules:t.categoryRules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"一级类目",prop:"pcat"}},[a("div",[t._v("\n          "+t._s(t.updateDate.pcatName)+"\n        ")])]),t._v(" "),a("el-form-item",{attrs:{label:"二级类目",prop:"catName"}},[a("el-input",{staticStyle:{width:"70%"},attrs:{"auto-complete":"off",placeholder:"请输入二级类目"},model:{value:t.updateForm.catName,callback:function(e){t.$set(t.updateForm,"catName","string"==typeof e?e.trim():e)},expression:"updateForm.catName"}})],1),t._v(" "),a("div",{staticClass:"filterShop"},[a("div",[a("span",[a("strong",[t._v("可用门店:")])]),t._v(" "),a("span",[t._v("门店编码")]),t._v(" "),a("el-input",{staticStyle:{width:"20%"},attrs:{"auto-complete":"off"},model:{value:t.queryShops.shopId,callback:function(e){t.$set(t.queryShops,"shopId","string"==typeof e?e.trim():e)},expression:"queryShops.shopId"}}),t._v(" "),a("span",[t._v("门店名称")]),t._v(" "),a("el-input",{staticStyle:{width:"20%"},attrs:{"auto-complete":"off"},model:{value:t.queryShops.shopName,callback:function(e){t.$set(t.queryShops,"shopName","string"==typeof e?e.trim():e)},expression:"queryShops.shopName"}}),t._v(" "),a("el-button",{attrs:{type:"primary",size:"medium"},on:{click:t.getQueryShops}},[t._v("筛选")])],1),t._v(" "),t.openShopData?a("div",[a("el-table",{staticStyle:{width:"100%","margin-top":"10px"},attrs:{data:t.shopData,"max-height":"180",border:""}},[a("el-table-column",{attrs:{align:"center",label:"序号"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                "+t._s(e.$index+1)+"\n              ")]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"id",label:"门店编号"}}),t._v(" "),a("el-table-column",{attrs:{prop:"name",label:"门店名称"}}),t._v(" "),a("el-table-column",{attrs:{prop:"type",label:"门店类别"}}),t._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.isSelect?a("el-button",{attrs:{size:"mini",type:"warning",plain:""},on:{click:function(a){t.returnShop(e.row)}}},[t._v("撤回取消")]):a("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(a){t.deleteShop(e.row)}}},[t._v("取消")])]}}])})],1)],1):t._e()])],1):t._e(),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.isShowDialog=!1}}},[t._v("取消")]),t._v(" "),"create"==t.dialogStatus?a("el-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.onSave}},[t._v("确定")]):a("el-button",{attrs:{type:"primary"},on:{click:t.onUpdate}},[t._v("确定")])],1)],1)],1)},staticRenderFns:[]};var r=a("VU/8")(s,i,!1,function(t){a("hFq1")},"data-v-7c3a73d6",null);e.default=r.exports},hFq1:function(t,e,a){var o=a("1QFH");"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);a("rjj0")("11cbda32",o,!0)},qsHl:function(t,e,a){"use strict";e.e=function(t){return Object(s.a)({url:"goods/cat/list",method:"POST",data:{token:Object(i.a)(),pid:t}})},e.f=function(t){return Object(s.a)({url:"shopcat/list",method:"POST",data:{token:Object(i.a)(),curPage:t.curPage,pageSize:t.pageSize}})},e.a=function(t){return Object(s.a)({url:"shopcat/update",method:"POST",data:{token:Object(i.a)(),pcat:t.pcat,cat:t.cat,catName:t.catName,shopIds:t.shopIds}})},e.b=function(t){return Object(s.a)({url:"goods/cat/add",method:"POST",data:{token:Object(i.a)(),name:t}})},e.c=function(t){return Object(s.a)({url:"shopcat/add",method:"POST",data:{token:Object(i.a)(),pcat:t.pcat,cat:t.cat,catName:t.catName,shopIds:t.shopIds}})},e.d=function(t,e){return Object(s.a)({url:"shopcat/delete",method:"POST",data:{token:Object(i.a)(),pcat:t,cat:e}})},e.g=function(t){var e={token:Object(i.a)()};for(var a in t)""!==t[a]&&o.default.set(e,a,t[a]);return Object(s.a)({url:"shopcat/validshops",method:"POST",data:e})};var o=a("7+uW"),s=a("vLgD"),i=a("TIfe")}});